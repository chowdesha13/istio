apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    cni:
      enabled: true
    ztunnel:
      enabled: true
    ingressGateways:
      - name: istio-ingressgateway
        enabled: false
  values:
    multicluster:
      enableReader: false
    gateways:
      # Intentionally break gateways. Users should deploy with Gateway API only.
      istio-ingressgateway:
        rollingMaxUnavailable: "WARNING ambient-only profile does not support installing Gateways; use the Gateway API object. This will intentionally fail to deploy"
      istio-egressgateway:
        rollingMaxUnavailable: "WARNING ambient-only profile does not support installing Gateways; use the Gateway API object. This will intentionally fail to deploy"
    global:
      operatorManageWebhooks: true
    base:
      enableCRDTemplates: true
      enableIstioConfigCRDs: false
      excludedCRDs:
      # Not supported in ambient (likely ever)
      - "sidecars.networking.istio.io"
      - "envoyfilters.networking.istio.io"
      # Not recommended in ambient (replaced with Gateway API)
      - "gateways.networking.istio.io"
      - "virtualservices.networking.istio.io"
      # Not supported in ambient (until VM supported is added)
      - "workloadgroups.networking.istio.io"
    profile: ambient
